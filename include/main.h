/**
 * @file xmain.h
 * @author Francis Gratton 
 * 
 * @brief Le fichier xmain.h est nécessaire pour les includions global qui
 *   contien les defines essentiel au fonctionnement. Le processeur utilisé
 *  pour la gestion du véhicule est un ESP32-S3. Voir le document de projet
 *  pour plus d'information sur le fonctionnement.
 *      
 *  Le programme suivant fonctionne avec une base de temps et des machine d'état.
 * 
 *   
 * @version 0.0.1
 * @date 2023-05-05
 * 
 * @copyright Copyright (c) 2023
 * 
 */

#ifndef MAIN_H
#define MAIN_H

//PROGRAMME: Batiscan
//DESCRIPTION: programme qui va permettre le bon fonctionnement d'un sous-marin

//HISTORIQUE:
/* Historique du programme gèrer par git et publier sur github au lien suivant
*
*       https://github.com/Franky55/Batiscan_Slave
*/
  
//  *** INFORMATION PUBLIQUE ***


//DEFINITIONS REQUISES PAR LE MODULE:
//Dependances materielles:








#define GROSSEUR_TAB_MOYENNE 10



#define GPIO10 10
#define GPIO10_TEMPS_POUR_RESET_EN_MS 1000











//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LA DRIVE MOTEUR ***/
#define DRIVE_MOTEUR 15


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LE POWER CAM ***/
#define CONTROL_POWER_CAM 47

#define TURN_ON 1
#define TURN_OFF 0

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LES LUMIERES ***/
#define LUMIERE_D 41
#define LUMIERE_G 42

#define TURN_ON 1
#define TURN_OFF 0

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LE NIVEAU DE LA BATTERIE ***/
#define PRESSION 5

#define PRESSION_MIN 0      // si je suis a zero techniquement je crois qu'on a un autre probleme
#define PRESSION_MAX 10

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LE NIVEAU DE LA BATTERIE ***/
#define POWER_BAT 4

#define POWER_BAT_MIN 20
#define POWER_BAT_MOY 50
#define POWER_BAT_MAX 90


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LA DETECTION D'EAU ***/
#define EAU 40

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LA TEMPERATURE ***/
#define TEMPERATURE 6

#define TEMPERATURE_MIN 5
#define TEMPERATURE_ELEVEE 40
#define TEMPERATURE_MAX 60


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LA BALLAST ***/
#define DIRECTION_BALLAST 1
#define DRIVE_BALLAST 16
#define VALVE 46

#define OPEN_VALVE 1
#define CLOSE_VALVE 0

/**
 * @brief Le temps est utilise par un compteur qui se fait avec la base de temps
 * 
 */
#define PROCESSUS_BALLAST_FULL_EN_MS 2500
#define PROCESSUS_BALLAST_EMPTY_EN_MS 0


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LES SERVOS MOTEURS  ***/
#define SERVO_X 17
#define SERVO_Y 18  //pas utilise
#define SERVO_GA 21
#define SERVO_GR 35
#define SERVO_DA 36
#define SERVO_DR 37
#define SERVO_H 38
#define SERVO_S 39

#define ANGLE_MAX 45
#define ANGLE_MIN -45
#define ANGLE_CENTER 92

/**
 * @brief À chaque 100 ms un nouveau servo moteur se fait update
 * Ils ne peuvent pas être en meme temps sinon manque de courant
 * Cause Frank is a big dumm dumm
 * 
 * My circuit goes: Nuh huh
 * 
 */
#define INTERFACE_PWM_TEMPS_UPDATE_EN_MS 100

#define INTERFACE_PWM_MOTEUR_TEMPS_UPDATE_EN_MS 50




//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LA COMMUNICATION I2C  ***/
#define I2C_SDA 8
#define I2C_SCL 7
#define INT 9

#define ADDRESSE 0x68



//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LA COMMUNICATION SPI  ***/
//#define MISO 7
//#define MOSI 8
//#define CLK 6
//#define CS1 9

#define SPI_MISO 13
#define SPI_MOSI 11
#define SPI_CLK 12
#define INTERFACE_SPI_CS1 2
#define INTERFACE_SPI_CS2 14

#define SPI_BUFFER_SIZE 255


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR NEOPIXEL ***/
#define NEOPIXEL  45
#define NUMPIXELS 1 




//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LA BASE DE TEMPS ***/

/***  DÉFINITION NÉCESSAIRE À LA BASE DE TEMPS  ***/
/**
 * @brief Période en microsecondes à laquelle le TaskServer exécute sa fonction 
 *  qui fait apelle au service Base de temps pour gêrer plusieur tache a la fois
 * 
 */
#define SERVICETASKSERVER_PERIODE_EN_US (1000L)
/**
 * @brief Fréquence en Hz de la base de temps
 * 
 */
#define SERVICEBASEDETEMPS_FREQUENCE_EN_HZ 1000
/**
 * @brief Nombre de phase dans une période de la base de temps (1 si pas utilisé)
 */
#define SERVICEBASEDETEMPS_NOMBRE_DE_PHASES_DANS_LOOP 3



/**
 * @brief Phase pour la communication SPI
 * 
 */
#define INTERFACESPI_TRANSACTION 1

#define PROCESSUS_CALCULE_ACCELEROMETRE_PHASE 2












//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LES PHASES DE LA BASE DE TEMPS ***/

/**
 * @brief Nombre de phase de la base de temps \ref xserviceBaseDeTemps.h
 * 
 */
#define SERVICEBASEDETEMPS_NOMBRE_DE_PHASES 9


/**
 * @brief Numéro de phase du processus clignotant
 */
#define PROCESSUSCLIGNOTANT_PHASE 0

/**
 * @brief Numéro de phase du processus Controle
 */
#define PROCESSUSCONTROLE_PHASE 1

/**
 * @brief Numéro de phase du processus PWM
 */
#define PROCESSUS_CALCULE_ACCELERATION 2

/**
 * @brief Phase pour la communication
 * 
 */
#define PROCESSUSCOMMUNICATION 3

/**
 * @brief Phase pour update les servos moteurs
 * 
 */
#define INTERFACE_UPDATE_PWM 4

/**
 * @brief La phase qui détermine s'il faut sauter à l'eau
 * 
 */
#define PROCESSUS_URGENCE_PHASE 5

/**
 * @brief La phase de la gestion de la ballast
 * 
 */
#define PROCESSUS_GESTION_BALLAST 6

/**
 * @brief Phase pour update les GPIOS
 * 
 */
#define INTERFACE_UPDATE_GPIO 7

/**
 * @brief Phase pour update les servos moteurs
 * 
 */
#define INTERFACE_UPDATE_MOTEUR 8



//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR NIVEAU D URGENCE ***/
#define NIVEAU_URGENCE_0 0
#define NIVEAU_URGENCE_BAS 1
#define NIVEAU_URGENCE_MOYEN 2
#define NIVEAU_URGENCE_HAUT 3
#define NIVEAU_URGENCE_URGENT 4


#define PROCESSUSURGENCE_LECTURE_UPDATE_EN_MS 100

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/***  DÉFINITION POUR LES TIMERS CLIGNOTANT ***/

#define PROCESSUSCLIGNOTANT_TEMPS_ALLUME_EN_MS 5000
#define PROCESSUSCLIGNOTANT_TEMPS_ETEINT_EN_MS 5000


#endif